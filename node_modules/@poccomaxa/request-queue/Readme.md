# request-queue

Library for sending http(s)-requests over one queue.

## Install
    npm install @poccomaxa/request-queue
## Using

###Interface

```javascript
/**
 * @param defaults {object} default options as options of http.ClientRequest
 * @param parallel {number=1} number of parallel requests
 * @param secured {boolean=false} true - https, false - http
 * @param keepsession {boolean=false} true - new cookies will be saved, false - cookies will be ignored
 * @constructor
 */
var RequestQueue = require('@poccomaxa/request-queue');

/**
 * get-request without body
 * @param path {String} url
 * @param callback {Function.<string, string, object>=null} called after execution of request
 * @param headers {object.<String, String>=null} headers of single request
 * */
RequestQueue.get(path, callback, headers);

/**
 * post-request with header "Content-Type: application/x-www-form-urlencoded" and body
 * @param path {String} url
 * @param data {String=} requests body
 * @param callback {Function.<string, string, object>=null} called after execution of request
 * @param headers {object.<String, String>=null} headers of single request
 * */
RequestQueue.post(path, data, callback, headers);

/**
 * put-request with header "Content-Type: application/x-www-form-urlencoded" and body
 * @param path {String} url
 * @param data {String=} requests body
 * @param callback {Function.<string, string, object>=null} called after execution of request
 * @param headers {object.<String, String>=null} headers of single request
 * */
RequestQueue.put(path, data, callback, headers);

/**
 * delete-request without body
 * @param path {String} url
 * @param callback {Function.<string, string, object>=null} called after execution of request
 * @param headers {object.<String, String>=null} headers of single request
 * */
RequestQueue.delete(path, callback, headers);

/**
 * adding or changing one header to defaults
 * @param name {String}
 * @param value {String}
 */
RequestQueue.setHeader(name, value);

/**
 * deleting header from defaults
 * @param name {String}
 */
RequestQueue.removeHeader(name);

/**
 * returns header if exists or undefined
 * @param name {String}
 * @returns {String|undefined}
 */
RequestQueue.getHeader(name);

/**
 * field host required to create connection
 */
defaults = {
    host: "example.com",
    headers: {
        "User-Agent": "Mozilla/5.0"
    }
};

/**
 * @param res {String|Error} contains response body or error of transport layer
 * @param status {number} http status code or -1 if error
 * @param headers {object|null} response headers or null if error
 */
callback = function (res, status, headers) {
    if (status == -1) {
        // process error
        console.log(res.message);
    } else {
        // process response
        console.log(res);

        // process headers
        console.log(headers["content-type"]);
    }
};
```

###example
```javascript
var RequestQueue = require('@poccomaxa/request-queue');
var secured = true; // https
var parallelLimit = 5; // 5 parallel requests
var keepsession = false; // keeps cookies

// RequestQueue(defaults, parallel, secured)
var firstQueue = new RequestQueue(
    {
        host: "example.com",
        headers: {
            "User-Agent": "Mozilla/5.0"
        }
    },
    parallelLimit,
    secured,
    keepsession);
firstQueue.setHeader("x-csrf-token", "0123456789");
firstQueue.setHeader("x-requested-with", "XMLHttpRequest");

firstQueue.post(
    "/some/path/to/resource",
    "param1=12&param2=2",
    function (res) {
        process(res);
        console.log("result of request:");
        console.log(res);
    });

firstQueue.get(
    "/some/path/to/resource",
    function (res) {
        process(res);
        console.log("result of request:");
        console.log(res);
    }, {
        "Referer": "https://example.com/ref"
    });
```
###Multiple queues
```javascript
var secondQueue = new RequestQueue({
    host: "example.com",
    headers: {
        "User-Agent": "Mozilla/5.0"
    }
});
```

###Caution
Queue works for single host.

Option "Method" can't be overriden.